---
title: L08-定义模版文件并完整回复用户消息
date: 2021-09-14 11:03:46
tags: 微信公众号、前端
categories: 
- 前端
- 微信公众号开发
cover: https://tva1.sinaimg.cn/large/008i3skNly1gufz5iy599j60uq0hoq6602.jpg
---

# **L08-定义模版文件并完整回复用户消息**

1、定义回复用户消息的模版文件  

- 在wechat文件夹里定义一个template.js的文件

- 我们可以把消息回复放在这里面，例如这么做：

![](https://tva1.sinaimg.cn/large/008i3skNly1gufz7thil9j616i0t479902.jpg)   

- 但这样做，存在很多重复性的代码

- 我们可以将公共部分拿出去，然后进行字符串的拼接

- 最后记得在auth.js中引入该模块  

![](https://tva1.sinaimg.cn/large/008i3skNly1gufz953ekuj615g0u0dl702.jpg)  

![](https://tva1.sinaimg.cn/large/008i3skNly1gufz9k6m21j610i0u0n1x02.jpg)

2、新建一个reply.js模块，来处理用户发送发送的消息类型和内容，以决定返回不同的内容给用户  

- 其余类型可自行查阅微信开发者文档进行查阅  

![](https://tva1.sinaimg.cn/large/008i3skNly1gufza8iwpoj60w50u0q5q02.jpg)  

![](https://tva1.sinaimg.cn/large/008i3skNly1gufzagn0doj616f0u0jv102.jpg)  

3、关键要点！

- options是一个对象
  
- 向reply中传入message对象，拿到里面的一些共有属性，判断完成后将content赋值给options里的content

- 接着将options传入template，使其转化为xml格式（回复的消息必须是xml格式），返回replyMessage

- 最后执行`res.send(replyMessage);`

4、测试

- 重启服务器，在测试号中发送1进行测试，结果如下：  
  
  ![](https://tva1.sinaimg.cn/large/008i3skNly1gufzbqk6i4j60u01sxn3a02.jpg)