<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Docker详解 | 小新's Blog</title><meta name="keywords" content="虚拟化"><meta name="author" content="小新"><meta name="copyright" content="小新"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="引言前提知识必须：熟悉Linux命令和相关背景知识 建议：Git相关知识，git，pull 定位和范围 Java开发： 语言：java Spring MVC&#x2F;Spring Boot&#x2F;MyBatis······  Docker开发 语言：Go Swarm&#x2F;Compose&#x2F;Machine&#x2F;mesos&#x2F;k8s·······   为什么需要Docker​       一款产品从开发到上线，从操作系统，到运">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker详解">
<meta property="og:url" content="https://liuwqtech.github.io/2021/11/24/Docker%20%E8%AF%A6%E8%A7%A3/index.html">
<meta property="og:site_name" content="小新&#39;s Blog">
<meta property="og:description" content="引言前提知识必须：熟悉Linux命令和相关背景知识 建议：Git相关知识，git，pull 定位和范围 Java开发： 语言：java Spring MVC&#x2F;Spring Boot&#x2F;MyBatis······  Docker开发 语言：Go Swarm&#x2F;Compose&#x2F;Machine&#x2F;mesos&#x2F;k8s·······   为什么需要Docker​       一款产品从开发到上线，从操作系统，到运">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gwyfm44hg3j30dm09uq2y.jpg">
<meta property="article:published_time" content="2021-11-24T13:20:46.000Z">
<meta property="article:modified_time" content="2022-03-07T00:46:49.200Z">
<meta property="article:author" content="小新">
<meta property="article:tag" content="虚拟化">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gwyfm44hg3j30dm09uq2y.jpg"><link rel="shortcut icon" href="https://tva1.sinaimg.cn/large/008i3skNgy1gpw51zrippj305k05k74p.jpg"><link rel="canonical" href="https://liuwqtech.github.io/2021/11/24/Docker%20%E8%AF%A6%E8%A7%A3/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"top-center"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-03-07 08:46:49'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://tva1.sinaimg.cn/large/008i3skNgy1gpw4suzt6aj30u00u077g.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">28</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://tva1.sinaimg.cn/large/008i3skNly1gwyfm44hg3j30dm09uq2y.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">小新's Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Docker详解</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-11-24T13:20:46.000Z" title="发表于 2021-11-24 21:20:46">2021-11-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-03-07T00:46:49.200Z" title="更新于 2022-03-07 08:46:49">2022-03-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/">常用工具</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>18分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Docker详解"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2021/11/24/Docker%20%E8%AF%A6%E8%A7%A3/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2021/11/24/Docker%20%E8%AF%A6%E8%A7%A3/" itemprop="commentCount"></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><h2 id="前提知识"><a href="#前提知识" class="headerlink" title="前提知识"></a>前提知识</h2><p><strong>必须：</strong>熟悉Linux命令和相关背景知识</p>
<p><strong>建议：</strong>Git相关知识，git，pull</p>
<h2 id="定位和范围"><a href="#定位和范围" class="headerlink" title="定位和范围"></a>定位和范围</h2><ul>
<li><p>Java开发：</p>
<p>语言：java</p>
<p>Spring MVC/Spring Boot/MyBatis······</p>
</li>
<li><p>Docker开发</p>
<p>语言：Go</p>
<p>Swarm/Compose/Machine/mesos/k8s·······</p>
</li>
</ul>
<h2 id="为什么需要Docker"><a href="#为什么需要Docker" class="headerlink" title="为什么需要Docker"></a>为什么需要Docker</h2><p>​       一款产品从开发到上线，从操作系统，到运行环境，再到应用配置。作为开发和运维之间的协作，我们需要考虑更多的问题。特别是各种版本迭代后，不同版本环境的兼容等等都是我们所需要考虑的。</p>
<p>​       Docker之所以发展如此迅速，是因为它对以上的问题给出了一个标准化的解决方案。</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gwlxroc3yuj317c0jqdi9.jpg" style="zoom: 50%;" />

<p>​       形象的说：<strong>项目带着环境一起走！</strong></p>
<p>​       总结一句话：<strong>一次构建，处处运行！</strong></p>
<h2 id="Docker理念"><a href="#Docker理念" class="headerlink" title="Docker理念"></a>Docker理念</h2><ul>
<li>Docker是基于Go语言实现的云开源项目。</li>
<li>Docker的主要目标是：“Build，Ship and Run Any App，Anywhere”，也就是通过对应用组件的封装、分发、部署、运行等生命周期的管理，使用户的APP（可以是一个Web应用或者是一个数据库应用）及其运行环境能够做到<strong>“一次封装，到处运行”</strong>。</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gwlxyhytg0j311e0gojt6.jpg" style="zoom:50%;" />

<p><strong>Docker：解决了运行环境的配置问题软件容器，方便做持续集成并有助于整体发布的容器虚拟化技术。</strong></p>
<h2 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h2><h3 id="之前的虚拟机技术"><a href="#之前的虚拟机技术" class="headerlink" title="之前的虚拟机技术"></a>之前的虚拟机技术</h3><p>​       虚拟机（Virtual Machine）就是一种带环境安装的一种解决方案。它可以在一种操作系统里面运行另一种操作系统，比如在Windows系统里面运行Linux系统，应用程序对此毫无感知，因为虚拟机看上去跟真实系统一模一样，而对于底层系统来说，虚拟机就是一个普通的文件，不需要了就删掉，对其他部分毫无影响。这类虚拟机完美的运行了另一套系统，能够使应用程序、操作系统和硬件三者之间的逻辑不变。</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gwly97ey8oj30dm0iw0t5.jpg" style="zoom: 33%;" />

<p><strong>缺点：</strong>1、资源占用多   2、冗余步骤多   3、启动慢</p>
<h3 id="容器虚拟机技术"><a href="#容器虚拟机技术" class="headerlink" title="容器虚拟机技术"></a>容器虚拟机技术</h3><p>​       由于之前的虚拟机存在这些缺点，Linux发展出现了另一种虚拟化技术：Linux容器。</p>
<p>​       <strong>Linux容器不是模拟一个完整的操作系统，而是对进程进行隔离。</strong>有了容器，就可以将软件运行所需要的所有资源打包到一个隔离的容器中。容器和虚拟机不同，不需要捆绑一整套操作系统，只需要软件工作所需的库资源和配置。系统因此而变得高效轻量并保证部署在任何环境中的软件都能始终如一地运行。</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gwmjtch6bcj30fe0joaap.jpg" style="zoom:33%;" />

<p> <strong>Docker和传统虚拟化方式的不同：</strong></p>
<ul>
<li>传统虚拟化技术是虚拟出一套硬件后，在其上运行一个完整的操作系统，在该系统上再运行所需要的应用进程。</li>
<li>而容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核，而且也<strong>没有进行硬件虚拟</strong>。因此容器<strong>更为轻便</strong>。</li>
<li>每个容器之间<strong>互相隔离</strong>，每个容器都有自己的文件系统，容器之间进程不会互相影响，能区分计算资源。</li>
</ul>
<h1 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h1><h2 id="前提说明"><a href="#前提说明" class="headerlink" title="前提说明"></a>前提说明</h2><p>CentOs Docker 安装：</p>
<ul>
<li>仅支持以下的CentOs版本：CentOs 6.5（64-bit）或更高的版本、CentOs 7（64-bit）</li>
</ul>
<p>前提条件：</p>
<ul>
<li>目前，CentOs 仅发行版本中的内核支持Docker</li>
<li>Docker运行在CentOs 7上，要求系统为64位，系统内核版本为3.10以上</li>
<li>Docker运行在CentOs 6.5或更高版本上，要求系统为64位，系统内核版本为2.6.32-431或更高版本</li>
</ul>
<p>查看自己的内核：</p>
<p>​       uname命令用于打印当前系统的相关信息（内核版本号、硬件架构、主机名称和操作系统类型等等）</p>
<h2 id="Docker-的基本组成"><a href="#Docker-的基本组成" class="headerlink" title="Docker 的基本组成"></a>Docker 的基本组成</h2><ul>
<li>镜像（image）</li>
</ul>
<p>​       Docker 镜像（Image）就是一个<strong>只读</strong>的模版。镜像可以用来创建Docker容器，<strong>一个镜像可以创建很多个容器</strong>。</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gwmkpi8o55j30y808uaai.jpg" style="zoom:33%;" />

<ul>
<li>容器（container）</li>
</ul>
<p>​       Docker利用容器（Container）独立运行的一个或一组应用。<strong>容器是用镜像创建的运行实例。</strong>它可以被启动、开始、停止、删除。每一个容器都是相互隔离的、保证安全的平台。</p>
<p>​       <strong>可以把容器看做成一个简易版的Linux环境</strong>（包括root用户权限、进程空间、用户空间和网络空间等）和运行在其中的应用程序。</p>
<p>​       容器的定义和镜像几乎一模一样，也是一堆层的统一视角，唯一区别在于容器的最上面那一层是可读可写的。</p>
<ul>
<li>仓库（repository）</li>
</ul>
<p>​       仓库（Repository是<strong>集中存放镜像文件</strong>的场所。 </p>
<p>​       仓库（Repository）和仓库注册服务器（Registry）是有区别的，仓库注册服务器上往往存放着多个仓库，每一个仓库中又包含了多个镜像，每一个镜像有不同的标签（tag）。</p>
<p>​       仓库分为公开仓库（Public）和私有仓库（Private）两种形式。<strong>最大的公开仓库是Docker Hub（<a target="_blank" rel="noopener" href="https://hub.docker.com/%EF%BC%89">https://hub.docker.com/）</a></strong>，存放了数量庞大的镜像供用户下载。国内的公开仓库包括阿里云、网易云等。</p>
<ul>
<li>Docker架构图</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gwmkiawzr6j31e00r8jux.jpg" style="zoom: 33%;" />

<p><strong>总结：</strong>Docker本身是一个容器运行载体或称之为管理引擎。我们把应用程序和配置依赖打包好形成一个可交付的运行环境，这个打包好的运行环境就似乎image镜像文件。只有通过这个镜像文件才能生成Docker容器。image文件可以看做是容器的模版。Docker根据image文件生成容器的实例。同一个image文件，可以生成多个同时运行的容器实例。</p>
<h2 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h2><p><a target="_blank" rel="noopener" href="https://www.runoob.com/docker/macos-docker-install.html">https://www.runoob.com/docker/macos-docker-install.html</a></p>
<p>查看Docker版本：<code>docker --version</code></p>
<h2 id="镜像加速"><a href="#镜像加速" class="headerlink" title="镜像加速"></a>镜像加速</h2><ul>
<li>阿里云镜像加速</li>
</ul>
<p>​       进入阿里云官网，登录后进入容器镜像服务—&gt;选择镜像工具—&gt;镜像加速器—&gt;根据对应系统进行配置操作</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gwmtfkqws9j31o00n0tby.jpg" style="zoom:33%;" />

<p>​       重启后终端输入<code>docker info</code>验证是否配置成功。</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gwmtj1y8fqj30lc04wmxe.jpg" style="zoom: 50%;" />

<ul>
<li>网易云镜像加速</li>
</ul>
<p><code> &quot;registry-mirrors&quot;: [     &quot;http://hub-mirror.c.163.com&quot;   ]</code></p>
<h2 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h2><p>​       命令<code>docker run hello-world</code></p>
<h1 id="运行底层原理"><a href="#运行底层原理" class="headerlink" title="运行底层原理"></a>运行底层原理</h1><h2 id="Docker是怎么工作的"><a href="#Docker是怎么工作的" class="headerlink" title="Docker是怎么工作的"></a>Docker是怎么工作的</h2><p>​       Docker是一个<strong>Client-Server结构</strong>的系统，Docker守护进程运行在主机上，然后通过Socket连接，从客户端访问，守护进程从客户端接受命令并管理运行在主机上的容器。</p>
<p>​       <strong>容器，是一个运行时环境</strong>，就是我们鲸鱼背上的集装箱。</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gwmz5o2m6uj30y60q20uw.jpg" style="zoom: 25%;" />

<h2 id="为什么docker比vm快"><a href="#为什么docker比vm快" class="headerlink" title="为什么docker比vm快"></a>为什么docker比vm快</h2><ul>
<li><p>Docker有着比虚拟机更少的抽象层。由于Docker不需要Hypervisor实现硬件资源的虚拟化，运行在Docker容器上的程序<strong>直接使用的都是实际物理机的硬件资源</strong>。因此，在CPU、内存利用率上Docker将会在效率上有明显的优势。</p>
</li>
<li><p>Docker利用的是宿主机的内核，而不需要Guest OS。因此，当新建一个容器时，Docker不需要和虚拟机一样重新加载一个操作系统内核，从而可以避免寻找、加载操作系统内核这个费时费资源的过程。当新建一个虚拟机时，虚拟机软件需要加载Guest OS，返回新建过程是分钟级别的，而Docker由于直接利用宿主机的操作系统，则省略了返回过程，。因此，<strong>新建一个Docker容器只需要几秒钟</strong>。</p>
</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gwmyq4804vj30rg0imgnn.jpg" style="zoom:33%;" />

<ul>
<li><strong>对比！（重要）</strong></li>
</ul>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gwmyqoljw5j311u0hkdi6.jpg" style="zoom: 25%;" />

<h1 id="Docker-常用命令"><a href="#Docker-常用命令" class="headerlink" title="Docker 常用命令"></a>Docker 常用命令</h1><h2 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h2><ul>
<li><strong><code>docker version</code>：查看版本</strong></li>
<li><strong><code>docker info</code>：查看详细信息</strong></li>
<li><strong><code>docker --help</code>：查看帮助</strong>  </li>
</ul>
<h2 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h2><ul>
<li><strong><code>docker images</code>：列出本地主机上的镜像</strong></li>
</ul>
<p>​       REPOSITORY：镜像的仓库源；TAG：镜像的标签；IMAGE ID：镜像ID；CREATED：镜像创建的时间；VIRTUAL SIZE：镜像大小</p>
<p>​       （1）-a：列出本地所有镜像（含中间映像层）</p>
<p>​       （2）-q：只显示镜像ID</p>
<p>​       （3）–digests：显示镜像的摘要信息</p>
<p>​       （4）–no-trunc：显示完整的镜像信息</p>
<p>​       <strong>我们使用<code>Repository:Tag</code>来表示一个镜像。</strong></p>
<ul>
<li><strong><code>docker search 某个镜像的名称</code>：搜索镜像</strong></li>
</ul>
<p>​       （1）–no-trunc：显示完整的镜像描述</p>
<p>​       （2）-s：列出收藏数不小于指定值的镜像</p>
<p>​       （3）–automated：只列出automated build类型的镜像</p>
<ul>
<li><p><strong><code>docker pull 某个镜像的名称[:TAG]</code>：下载镜像</strong></p>
</li>
<li><p><strong><code>docker rmi 某个镜像名称的ID</code>：删除镜像</strong></p>
</li>
</ul>
<p>​       （1）删除单个：<code>docker rmi -f 镜像ID</code></p>
<p>​       （2）删除多个：<code>docker rmi -f 镜像名1:TAG 镜像名2:TAG</code></p>
<p>​       （3）删除全部：<code>docker rmi-f $(docker images -qa)</code></p>
<h2 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h2><ul>
<li><strong><code>docker run [options] image [command][arg...]</code>：新建并启动交互式容器</strong></li>
</ul>
<p>​       options说明（常用）：</p>
<p>​              –name=”容器的新名字”：为容器指定一个名称；</p>
<p>​              <strong>-d：后台运行容器，并返回容器ID，也即启动守护式容器</strong></p>
<p>​              <strong>-i：以交互模式运行容器，通常与-t同时使用</strong></p>
<p>​              <strong>-t：为容器重新分配一个伪输入终端，通常与-i同时使用</strong></p>
<p>​              <strong>-P：随机端口映射</strong></p>
<p>​              <strong>-p：指定端口映射</strong>，有以下4种形式：</p>
<p>​                     ip:hostPort:containerPort</p>
<p>​                     ip::containerPort</p>
<p>​                     <strong>hostPort:containerPort</strong></p>
<p>​                     containerPort</p>
<ul>
<li><strong><code>docker ps [options]</code>：列出当前所有正在运行的容器</strong></li>
</ul>
<p>​       options说明（常用）：</p>
<p>​              -a：列出当前所有正在运行的容器+历史上运行过的</p>
<p>​              -l：显示最近创建的容器</p>
<p>​              -n：显示最近n个创建的容器</p>
<p>​              <strong>-q：静默模式，只显示容器编号</strong></p>
<p>​              –no-trunc：不截断输出</p>
<ul>
<li><strong><code>exit</code>：容器停止退出</strong></li>
<li><strong><code>ctrl+P+Q</code>：容器不停止退出</strong></li>
<li><strong><code>docker start 容器ID或者容器名</code>：启动容器</strong></li>
<li><strong><code>docker restart 容器ID或者容器名</code>：重启容器</strong></li>
<li><strong><code>docker stop 容器ID或者容器名</code>：停止容器</strong></li>
<li><strong><code>docker kill 容器ID或者容器名</code>：强制停止容器</strong></li>
<li><strong><code>docker rm 容器ID</code>：删除已停止的容器</strong></li>
</ul>
<p>​       一次性删除多个容器：</p>
<p>​              <code>docker rm -f $(docker ps -aq)</code></p>
<p>​              <code>docker ps -aq | xargs docker rm</code></p>
<p><strong>重要：</strong></p>
<p>​       （1）**<code>docker run -d 容器名</code>：启动守护式容器**</p>
<p>​       （2）**<code>docker logs -f -t --tail 容器ID</code>：查看容器日志**</p>
<p>​              -t：加入时间戳</p>
<p>​              -f：跟随最新的日志打印</p>
<p>​              –tail 数字：显示最后多少条</p>
<p>​       （3）**<code>docker top 容器ID</code>：查看容器内运行的进程**</p>
<p>​       （4）**<code>docker inspect 容器ID</code>：查看容器内部细节**</p>
<p>​       （5）进入正在运行的容器并以命令行交互：</p>
<p>​                        <strong><code>docker exec -it 容器ID bashShell</code></strong></p>
<p>​                        <strong><code>docker attach 容器ID</code></strong></p>
<p>​                区别：attach：直接进入容器启动命令的终端，不会启动新的进程；</p>
<p>​                            exec：在容器中打开新的终端，并且可以启动新的进程</p>
<p>​       （6）**<code>docker cp 容器ID:容器内路径 目的主机路径</code>：从容器内拷贝文件到主机上**</p>
<h1 id="Docker-镜像"><a href="#Docker-镜像" class="headerlink" title="Docker 镜像"></a>Docker 镜像</h1><h2 id="是什么"><a href="#是什么" class="headerlink" title="是什么"></a>是什么</h2><h3 id="UnionFS（联合文件系统）"><a href="#UnionFS（联合文件系统）" class="headerlink" title="UnionFS（联合文件系统）"></a>UnionFS（联合文件系统）</h3><p>​       Union文件系统（UnionFS）是一种分层、轻量级并且高性能的文件系统，它支持<strong>对文件系统的修改作为一次提交来一层层的叠加</strong>，同时可以将不同目录挂载到同一个虚拟文件系统下。</p>
<p>​       Union文件系统时Docker镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</p>
<p>​       <strong>特性：</strong>一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件会包含所有底层的文件和目录。</p>
<h3 id="Docker-镜像加载原理"><a href="#Docker-镜像加载原理" class="headerlink" title="Docker 镜像加载原理"></a>Docker 镜像加载原理</h3><p>​       Docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统是UnionFS。</p>
<p>​       bootfs（boot file system）主要包含bootloader和kernel，bootloader主要是引导加载kernel，Linux刚启动时会加载bootfs文件系统，在Docker镜像的最底层就是bootfs。这一层与我们典型的Linux/Unix系统是一样的，包含boot加载器和内核。当boot加载完成之后，整个内核就都在内存中了，此时内存的使用权已经由bootfs转交给内核，此时系统也会写在bootfs。</p>
<p>​       rootfs（root file system），在bootfs之上，包含的就是典型Linux系统中的/dev，/proc，/bin，/etc等标准目录和文件。rootfs就是各种不同的操作系统的发行版，比如Ubuntu，CentOs等等。</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gwnn7ysl4jj30pi0f0q4g.jpg" style="zoom: 33%;" />

<p><strong>问题：</strong>平时我们安装进虚拟机的CentOs都是好几个G，为什么Docker这里才只需要200M？</p>
<p><strong>答：</strong>对于一个精简的OS，rootfs可以很小，只需要包括最基本的命令、工具、和程序库就可以了，因为底层直接使用的是Host的Kernel，自己只需要提供rootfs就行了。由此可见，对于不同的Linux发行版，bootfs基本是一致的，rootfs会有差别，因此不同的发行版可以公用bootfs。</p>
<h3 id="分层的镜像"><a href="#分层的镜像" class="headerlink" title="分层的镜像"></a>分层的镜像</h3><p>​       镜像，<strong>一层一层下载</strong>，包含了运行时所需的全部环境。</p>
<p>​       例如，Tomcat，为什么有400多M，因为里面可能包含centos，jdk8，tomcat等。</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gwnnjlxajvj310k0hugnv.jpg" style="zoom: 25%;" />

<h3 id="为什么采用这种分层结构"><a href="#为什么采用这种分层结构" class="headerlink" title="为什么采用这种分层结构"></a>为什么采用这种分层结构</h3><p>​       最大的一个好处——<strong>共享资源</strong>。</p>
<p>​       例如，有多个镜像都从相同的base镜像构建而来，那么宿主机只需在磁盘上保存一份base镜像，同时内存中也只需要加载一份base镜像，就可以为所有的容器服务了，同时，<strong>镜像的每一层都可以被共享</strong>。</p>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ul>
<li>Docker镜像都是只读的</li>
<li>当容器启动时，一个新的可写层被加载到镜像的顶部</li>
<li>这一层通常被称作“容器层”，“容器层”之下的都叫“镜像层”</li>
</ul>
<h2 id="Docker镜像commit操作"><a href="#Docker镜像commit操作" class="headerlink" title="Docker镜像commit操作"></a>Docker镜像commit操作</h2><ul>
<li>docker commit 提交容器副本使之成为一个新的镜像</li>
<li><code>docker -m=&quot;提交的描述信息&quot; -a=&quot;作者&quot; 容器ID 要创建的目标镜像名:[标签名]</code></li>
</ul>
<p><strong>案例演示：</strong></p>
<p>1、从Hub上下载Tomcat镜像到本地并成功运行</p>
<p>​        <code>docker run -it -p 8080:8080 tomcat</code></p>
<p>​                    -p：主机端口：docker容器端口</p>
<p>​                    -P：随机分配端口</p>
<p>​                    -i：交互</p>
<p>​                    -t：终端</p>
<p>2、故意删除上一步镜像产生的tomcat容器的文档</p>
<p>​            进入webapps目录下，删除docs</p>
<p>3、当前运行的tomcat是一个没有文档内容的容器，以它为模版，commit一个新镜像</p>
<p>4、启动新镜像和原来的进行对比</p>
<p>​            新镜像：没有docs</p>
<p>​            原来的：有docs</p>
<h1 id="Docker-容器数据卷"><a href="#Docker-容器数据卷" class="headerlink" title="Docker 容器数据卷"></a>Docker 容器数据卷</h1><h2 id="是什么-1"><a href="#是什么-1" class="headerlink" title="是什么"></a>是什么</h2><p>​       先来看看Docker的理念：</p>
<ul>
<li>将应用与运行时环境打包形成容器运行，运行可以伴随着容器，但是我们对数据的要求希望是持久化的</li>
<li>容器之间希望有可能共享数据</li>
</ul>
<p>​       Docker容器产生的数据，如果不通过docker commit生成新的镜像，使得数据成为镜像的一部分保存下来，那么当容器删除后，数据自然也就没有了。</p>
<p>​       <strong>为了能够保存数据，我们在Docker中使用卷。</strong></p>
<h2 id="能干什么"><a href="#能干什么" class="headerlink" title="能干什么"></a>能干什么</h2><ul>
<li><strong>容器的持久化</strong></li>
<li><strong>容器间继承+共享数据</strong></li>
</ul>
<p>​       卷就是目录或文件，存在于一个或多个容器中，由Docker挂载到容器，但不属于联合文件系统，因此能够绕过Union File System提供一些用于<strong>持续存储或共享数据</strong>的特性。</p>
<p>​       卷的设计目的就是数据的持久化，<strong>完全独立于容器的生命周期</strong>，因此，Docker不会在容器删除时删除其挂载的数据卷。</p>
<p>​       特点：</p>
<ul>
<li>数据卷可在容器之间共享或重用数据</li>
<li>卷中的更改可以直接生效</li>
<li>数据卷的更改不会包含在镜像的更新中</li>
<li>数据卷的生命周期一直持续到没有容器使用它为止</li>
</ul>
<h2 id="添加数据卷"><a href="#添加数据卷" class="headerlink" title="添加数据卷"></a>添加数据卷</h2><p>（1）<strong>直接命令添加</strong></p>
<ul>
<li>添加：**<code>docker run -it -v /宿主机绝对路径目录:/容器内目录 镜像名</code>**</li>
<li>查看数据卷是否挂载成功：<code>docker inspect 容器ID</code> 查看Volumes</li>
<li>容器和宿主机之间数据共享</li>
<li>容器停止退出后，主机修改后数据是否同步：是</li>
<li>命令（带权限）：<code>docker run -it -v /宿主机绝对路径目录:/容器内目录:ro 镜像名</code></li>
</ul>
<p>（2）<strong>DockerFile添加</strong></p>
<ul>
<li>根目录下新建mydocker文件夹并进入</li>
<li>可在DockerFile中使用VOLUME指令来给镜像添加一个或多个数据卷</li>
</ul>
<p> <strong><code>VOLUME[&quot;/dataVolumeContainer&quot;,&quot;/dataVolumeContainer2&quot;,&quot;/dataVolumeContainer3&quot;]</code></strong></p>
<p>​       <strong>说明：</strong>出于可移植和分享的考虑，用<code>-v /宿主机绝对路径目录:/容器内目录</code>不能够直接在DockerFile中实现。</p>
<ul>
<li>File构建：例如 </li>
</ul>
<figure class="highlight plain"><figcaption><span>volume test</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">VOLUME [&quot;&#x2F;dataVolumeContainer1&quot;,&quot;&#x2F;dataVolumeContainer2&quot;]</span><br><span class="line">CMD echo &quot;finished,----------success&quot;</span><br><span class="line">CMD &#x2F;bin&#x2F;bash&#96;&#96;&#96;</span><br></pre></td></tr></table></figure>

<ul>
<li>build后生成镜像</li>
<li>run容器</li>
<li>对应主机目录地址：会有一个默认的地址</li>
</ul>
<h2 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h2><p>​       <strong>定义：</strong>命名的容器挂载数据卷，其他容器通过挂载这个（父容器）实现数据共享，挂载数据卷的容器，称之为数据卷容器。</p>
<p>​       <strong>使用<code>--volumes-from</code>进行容器间的传递共享</strong></p>
<ul>
<li>先启动一个父容器dc01</li>
<li>再启动dc02/dc03继承自dc01</li>
</ul>
<p>​       <strong>结论：容器之间配置信息的传递，数据卷的生命周期一直持续到没有任何容器使用它为止。</strong></p>
<h1 id="DockerFile解析"><a href="#DockerFile解析" class="headerlink" title="DockerFile解析"></a>DockerFile解析</h1><h2 id="是什么-2"><a href="#是什么-2" class="headerlink" title="是什么"></a>是什么</h2><p>​       DockerFile是用来构建Docker镜像的构建文件，是由一系列命令和参数构成的脚本。</p>
<p>​       <strong>构建三步骤：</strong>（1）编写DockerFile文件（2）<code>docker build</code>（3）<code>docker run</code></p>
<h2 id="DockerFile构建过程解析"><a href="#DockerFile构建过程解析" class="headerlink" title="DockerFile构建过程解析"></a>DockerFile构建过程解析</h2><p>（1）DockerFile内容基础知识</p>
<ul>
<li>每条保留字指令都必须为大写字母，且后面要跟随至少一个参数</li>
<li>指令按照从上到下，顺序执行</li>
<li>#表示注释</li>
<li>每条指令都会创建一个新的镜像层，并对镜像进行提交</li>
</ul>
<p>（2）Docker执行DockerFile的大致流程</p>
<ul>
<li>docker从基础镜像运行一个容器</li>
<li>执行一条指令并对容器作出修改</li>
<li>执行类似docker commit的操作提交一个新的镜像层</li>
<li>docker再基于刚提交的镜像运行一个新容器</li>
<li>执行DockerFile中的下一条执行，直到所有指令都执行完成</li>
</ul>
<p><strong>总结：</strong></p>
<p>​       从应用软件角度来看，DockerFile、Docker镜像与Docker容器分别代表软件的三个不同阶段：</p>
<ul>
<li>DockerFile是软件的原材料</li>
<li>Docker镜像是软件的交付品</li>
<li>Docker容器则可以认为是软件的运行态</li>
</ul>
<p>​       DockerFile面向开发，Docker镜像成为交付标准，Docker容器则涉及部署与运维，三者缺一不可，合力充当Docker体系的基石。</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gwr765ou85j310a0faabe.jpg" style="zoom:33%;" />

<ul>
<li>DockerFile，需要定义一个DockerFile，DockerFile定义了进程需要的一切东西。DockerFile涉及的内容包括执行代码或者是文件、环境变量、依赖包、运行时环境、动态链接、操作系统的发行版、服务进程和内核进程（当应用程序需要和系统服务和内核进程打交道，这时需要考虑如何设计namespace的权限控制）等等。</li>
<li>Docker镜像，在用DockerFile定义了一个文件后，docker build时就会产生一个Docker镜像，当运行Docker镜像时，会真正开始提供服务。</li>
<li>Docker容器，容器时直接提供服务的。</li>
</ul>
<h2 id="DockerFile-保留字"><a href="#DockerFile-保留字" class="headerlink" title="DockerFile 保留字"></a>DockerFile 保留字</h2><ul>
<li>FROM：基础镜像，当前镜像是基于哪个镜像的</li>
<li>MAINTAINER：镜像维护者的姓名和邮箱地址</li>
<li>RUN：容器构建时需要运行的命令</li>
<li>EXPOSE：当前容器对外暴露出的端口号</li>
<li>WORKDIR：指定在创建容器后，终端默认登陆进来的工作目录，一个落脚点</li>
<li>ENV：用来构建镜像过程中设置环境变量</li>
<li>ADD：将宿主机目录下的文件拷贝进镜像且ADD命令会<strong>自动处理URL和解压tar压缩包</strong></li>
<li>COPY：类似ADD，拷贝文件和目录到镜像中</li>
<li>VOLUME：容器数据卷，用于数据保存和持久化工作</li>
<li>CMD：指定一个容器启动时要运行的命令。DockerFile中可以有多个CMD指令，但只有最后一个生效，CMD会被docker run之后的参数替换</li>
<li>ENTRYPOINT：指定一个容器启动时要运行的命令。指定容器启动程序和参数。docker run之后的参数会传递给ENTRYPOINT，之后形成新的命令组合</li>
<li>ONBUILD：当构建一个被继承的DockerFile时运行命令，父镜像在被子镜像继承后，父镜像的onbuild被触发</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gwr834pqccj316e0so41d.jpg" style="zoom: 25%;" />

<h1 id="Docker-常用安装"><a href="#Docker-常用安装" class="headerlink" title="Docker 常用安装"></a>Docker 常用安装</h1><h2 id="总体步骤"><a href="#总体步骤" class="headerlink" title="总体步骤"></a>总体步骤</h2><ul>
<li>搜索镜像</li>
<li>拉取镜像</li>
<li>查看镜像</li>
<li>启动镜像</li>
<li>停止容器</li>
<li>移除容器</li>
</ul>
<h2 id="安装-Tomcat"><a href="#安装-Tomcat" class="headerlink" title="安装 Tomcat"></a>安装 Tomcat</h2><ul>
<li>docker hub上查找tomcat镜像：<code>docker search tomcat</code></li>
<li>从docker hub上拉取tomcat镜像到本地：<code>docker pull tomcat</code></li>
<li><code>docker images</code> 查看是否有拉取到Tomcat</li>
<li>使用Tomcat镜像创建容器：<code>docker run -it -p 8080:8080 tomcat</code></li>
</ul>
<h2 id="安装-Mysql"><a href="#安装-Mysql" class="headerlink" title="安装 Mysql"></a>安装 Mysql</h2><ul>
<li>docker hub上查找mysql镜像：<code>docker search mysql:5.6</code></li>
<li>从docker hub上拉取mysql镜像到本地，标签为5.6：<code>docker pull mysql:5.6</code></li>
<li>使用mysql5.6镜像创建容器：</li>
</ul>
<p>​       （1）使用mysql镜像：<code>docker run -p 12345:3306 --name mysql -v xxx -v xxx -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.6</code></p>
<p>​       （2）外部系统也来连接运行在docker上的mysql服务</p>
<p>​       （3）数据备份（导出数据库表）：<code>docker exec mysql服务容器ID sh -c &#39;exec mysqldump --all-databases -uroot -p&quot;123456&quot;&#39;&gt;/lwq/all-databases.sql</code></p>
<h2 id="安装Redis"><a href="#安装Redis" class="headerlink" title="安装Redis"></a>安装Redis</h2><ul>
<li>docker hub上查找redis镜像：<code>docker search redis:3.2 </code></li>
<li>从docker hub上拉取redis镜像到本地，标签为3.2：<code>docker pull redis:3.2</code></li>
<li>使用redis 3.2镜像创建容器：</li>
</ul>
<p>​       （1）使用redis镜像：<code>docker run -p 6379:6379 -v xxx -v xxx -d redis:3.2 redis-server /usr/local/etc/redis/redis.conf --appendonly yes</code></p>
<p>​       （2）在主机/xxx/myredis/conf/redis.conf 目录下新建redis.conf文件：<code>vim /xxx/myredis/conf/redis.conf/redis.conf</code></p>
<ul>
<li><code>docker exec -it 运行着的Redis服务容器的ID redis-cli</code></li>
<li>退回宿主机，查看持久化文件appendonly.aof是否生成</li>
</ul>
<h1 id="本地镜像发布到阿里云"><a href="#本地镜像发布到阿里云" class="headerlink" title="本地镜像发布到阿里云"></a>本地镜像发布到阿里云</h1><p>​        <strong>流程：</strong></p>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gwyenzug57j310u0twmz0.jpg" style="zoom: 33%;" />

<ul>
<li>镜像生成</li>
</ul>
<p>​       （1）编写DockerFile文件</p>
<p>​       （2）从容器创建一个新的镜像：<code>docker commit [options] 容器ID [repository[:tag]]</code></p>
<ul>
<li>本地镜像推送到阿里云</li>
</ul>
<p>​       （1）本地镜像素材原型</p>
<p>​       （2）阿里云开发者平台——<code>https://dev.aliyun.com/search.html</code></p>
<p>​       （3）创建仓库镜像：命名空间+仓库名称</p>
<p>​       （4）将镜像推送到registry（阿里云网站上有过程，点击仓库管理）</p>
<p>​       （5）公有云可以查询到 </p>
<p>​       （6）查看详情</p>
<ul>
<li>将阿里云上的镜像下载到本地</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">小新</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://liuwqtech.github.io/2021/11/24/Docker%20%E8%AF%A6%E8%A7%A3/">https://liuwqtech.github.io/2021/11/24/Docker%20%E8%AF%A6%E8%A7%A3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://liuwqTech.github.io" target="_blank">小新's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%99%9A%E6%8B%9F%E5%8C%96/">虚拟化</a></div><div class="post_share"><div class="social-share" data-image="https://tva1.sinaimg.cn/large/008i3skNly1gwyfm44hg3j30dm09uq2y.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://tva1.sinaimg.cn/large/008i3skNgy1gpw4zwo9g9j30jd0j8wgz.jpg" target="_blank"><img class="post-qr-code-img" src="https://tva1.sinaimg.cn/large/008i3skNgy1gpw4zwo9g9j30jd0j8wgz.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://tva1.sinaimg.cn/large/008i3skNgy1gpw504owa0j30ft0im40s.jpg" target="_blank"><img class="post-qr-code-img" src="https://tva1.sinaimg.cn/large/008i3skNgy1gpw504owa0j30ft0im40s.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/03/06/%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%88%86%E6%9E%90/1.1%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1%E7%9B%AE%E6%A0%87%E2%80%94%E8%BE%93%E5%87%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E9%A6%96%E6%AC%A1%E5%87%BA%E7%8E%B0%E4%B8%89%E6%AC%A1%E7%9A%84%E5%AD%97%E7%AC%A6/"><img class="prev-cover" src="https://tva1.sinaimg.cn/large/e6c9d24ely1h01do77cbcj20mm0hqt9j.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">输出字符串中首次出现三次的字符</div></div></a></div><div class="next-post pull-right"><a href="/2021/11/02/Shiro%E5%92%8CSpring%20Security%E5%AF%B9%E6%AF%94/"><img class="next-cover" src="https://tva1.sinaimg.cn/large/008i3skNly1gvjsbbrnggj60g40fm74w02.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Shiro和Spring Security对比</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://tva1.sinaimg.cn/large/008i3skNgy1gpw4suzt6aj30u00u077g.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">小新</div><div class="author-info__description">“可以微弱，但要有光”</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">28</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/liuwqTech"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/liuwqTech" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:1096463510@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">一名准研究生，热爱计算机编程，会定期分享一些实用教程，欢迎大家多多点赞评论！有问题可以私q：1096463510</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">引言</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E7%9F%A5%E8%AF%86"><span class="toc-number">1.1.</span> <span class="toc-text">前提知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%BD%8D%E5%92%8C%E8%8C%83%E5%9B%B4"><span class="toc-number">1.2.</span> <span class="toc-text">定位和范围</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81Docker"><span class="toc-number">1.3.</span> <span class="toc-text">为什么需要Docker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E7%90%86%E5%BF%B5"><span class="toc-number">1.4.</span> <span class="toc-text">Docker理念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E6%AF%94"><span class="toc-number">1.5.</span> <span class="toc-text">对比</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%8B%E5%89%8D%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%8A%80%E6%9C%AF"><span class="toc-number">1.5.1.</span> <span class="toc-text">之前的虚拟机技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%8A%80%E6%9C%AF"><span class="toc-number">1.5.2.</span> <span class="toc-text">容器虚拟机技术</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">Docker安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E8%AF%B4%E6%98%8E"><span class="toc-number">2.1.</span> <span class="toc-text">前提说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90"><span class="toc-number">2.2.</span> <span class="toc-text">Docker 的基本组成</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.3.</span> <span class="toc-text">安装步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F"><span class="toc-number">2.4.</span> <span class="toc-text">镜像加速</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hello-World"><span class="toc-number">2.5.</span> <span class="toc-text">Hello World</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span class="toc-number">3.</span> <span class="toc-text">运行底层原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E6%98%AF%E6%80%8E%E4%B9%88%E5%B7%A5%E4%BD%9C%E7%9A%84"><span class="toc-number">3.1.</span> <span class="toc-text">Docker是怎么工作的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88docker%E6%AF%94vm%E5%BF%AB"><span class="toc-number">3.2.</span> <span class="toc-text">为什么docker比vm快</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">4.</span> <span class="toc-text">Docker 常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%AE%E5%8A%A9%E5%91%BD%E4%BB%A4"><span class="toc-number">4.1.</span> <span class="toc-text">帮助命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">4.2.</span> <span class="toc-text">镜像命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">4.3.</span> <span class="toc-text">容器命令</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-%E9%95%9C%E5%83%8F"><span class="toc-number">5.</span> <span class="toc-text">Docker 镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">5.1.</span> <span class="toc-text">是什么</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UnionFS%EF%BC%88%E8%81%94%E5%90%88%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%EF%BC%89"><span class="toc-number">5.1.1.</span> <span class="toc-text">UnionFS（联合文件系统）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-%E9%95%9C%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86"><span class="toc-number">5.1.2.</span> <span class="toc-text">Docker 镜像加载原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B1%82%E7%9A%84%E9%95%9C%E5%83%8F"><span class="toc-number">5.1.3.</span> <span class="toc-text">分层的镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%87%87%E7%94%A8%E8%BF%99%E7%A7%8D%E5%88%86%E5%B1%82%E7%BB%93%E6%9E%84"><span class="toc-number">5.1.4.</span> <span class="toc-text">为什么采用这种分层结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E7%82%B9"><span class="toc-number">5.2.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E9%95%9C%E5%83%8Fcommit%E6%93%8D%E4%BD%9C"><span class="toc-number">5.3.</span> <span class="toc-text">Docker镜像commit操作</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">6.</span> <span class="toc-text">Docker 容器数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-1"><span class="toc-number">6.1.</span> <span class="toc-text">是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%BD%E5%B9%B2%E4%BB%80%E4%B9%88"><span class="toc-number">6.2.</span> <span class="toc-text">能干什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">6.3.</span> <span class="toc-text">添加数据卷</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AE%B9%E5%99%A8"><span class="toc-number">6.4.</span> <span class="toc-text">数据卷容器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DockerFile%E8%A7%A3%E6%9E%90"><span class="toc-number">7.</span> <span class="toc-text">DockerFile解析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-2"><span class="toc-number">7.1.</span> <span class="toc-text">是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DockerFile%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B%E8%A7%A3%E6%9E%90"><span class="toc-number">7.2.</span> <span class="toc-text">DockerFile构建过程解析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DockerFile-%E4%BF%9D%E7%95%99%E5%AD%97"><span class="toc-number">7.3.</span> <span class="toc-text">DockerFile 保留字</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-%E5%B8%B8%E7%94%A8%E5%AE%89%E8%A3%85"><span class="toc-number">8.</span> <span class="toc-text">Docker 常用安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E4%BD%93%E6%AD%A5%E9%AA%A4"><span class="toc-number">8.1.</span> <span class="toc-text">总体步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-Tomcat"><span class="toc-number">8.2.</span> <span class="toc-text">安装 Tomcat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-Mysql"><span class="toc-number">8.3.</span> <span class="toc-text">安装 Mysql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Redis"><span class="toc-number">8.4.</span> <span class="toc-text">安装Redis</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E5%8F%91%E5%B8%83%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91"><span class="toc-number">9.</span> <span class="toc-text">本地镜像发布到阿里云</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/03/06/%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%88%86%E6%9E%90/1.2%E7%AE%97%E6%B3%95%E6%8F%8F%E8%BF%B0%E2%80%94%E8%AE%A1%E7%AE%971+2+%C2%B7%C2%B7%C2%B7%C2%B7%C2%B7%C2%B7+n%E7%9A%84%E5%80%BC/" title="计算1+2+······+n的值"><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h01e1k1cg3j20km0g4mxl.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算1+2+······+n的值"/></a><div class="content"><a class="title" href="/2022/03/06/%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%88%86%E6%9E%90/1.2%E7%AE%97%E6%B3%95%E6%8F%8F%E8%BF%B0%E2%80%94%E8%AE%A1%E7%AE%971+2+%C2%B7%C2%B7%C2%B7%C2%B7%C2%B7%C2%B7+n%E7%9A%84%E5%80%BC/" title="计算1+2+······+n的值">计算1+2+······+n的值</a><time datetime="2022-03-06T03:00:32.848Z" title="发表于 2022-03-06 11:00:32">2022-03-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/06/%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%88%86%E6%9E%90/1.1%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1%E7%9B%AE%E6%A0%87%E2%80%94%E8%BE%93%E5%87%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E9%A6%96%E6%AC%A1%E5%87%BA%E7%8E%B0%E4%B8%89%E6%AC%A1%E7%9A%84%E5%AD%97%E7%AC%A6/" title="输出字符串中首次出现三次的字符"><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h01do77cbcj20mm0hqt9j.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="输出字符串中首次出现三次的字符"/></a><div class="content"><a class="title" href="/2022/03/06/%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%88%86%E6%9E%90/1.1%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1%E7%9B%AE%E6%A0%87%E2%80%94%E8%BE%93%E5%87%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E9%A6%96%E6%AC%A1%E5%87%BA%E7%8E%B0%E4%B8%89%E6%AC%A1%E7%9A%84%E5%AD%97%E7%AC%A6/" title="输出字符串中首次出现三次的字符">输出字符串中首次出现三次的字符</a><time datetime="2022-03-06T03:00:32.848Z" title="发表于 2022-03-06 11:00:32">2022-03-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/11/24/Docker%20%E8%AF%A6%E8%A7%A3/" title="Docker详解"><img src="https://tva1.sinaimg.cn/large/008i3skNly1gwyfm44hg3j30dm09uq2y.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker详解"/></a><div class="content"><a class="title" href="/2021/11/24/Docker%20%E8%AF%A6%E8%A7%A3/" title="Docker详解">Docker详解</a><time datetime="2021-11-24T13:20:46.000Z" title="发表于 2021-11-24 21:20:46">2021-11-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/11/02/Shiro%E5%92%8CSpring%20Security%E5%AF%B9%E6%AF%94/" title="Shiro和Spring Security对比"><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvjsbbrnggj60g40fm74w02.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Shiro和Spring Security对比"/></a><div class="content"><a class="title" href="/2021/11/02/Shiro%E5%92%8CSpring%20Security%E5%AF%B9%E6%AF%94/" title="Shiro和Spring Security对比">Shiro和Spring Security对比</a><time datetime="2021-11-02T01:22:46.000Z" title="发表于 2021-11-02 09:22:46">2021-11-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/10/18/%E5%AE%9E%E6%88%98-%E7%AE%80%E6%98%93%E7%9A%84%E6%95%99%E5%8A%A1%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/" title="实战—基于SpringBoot+shiro+Vue前后端完全分离的简易教务系统"><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvjsf3p8zqj609m0e2t8s02.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="实战—基于SpringBoot+shiro+Vue前后端完全分离的简易教务系统"/></a><div class="content"><a class="title" href="/2021/10/18/%E5%AE%9E%E6%88%98-%E7%AE%80%E6%98%93%E7%9A%84%E6%95%99%E5%8A%A1%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/" title="实战—基于SpringBoot+shiro+Vue前后端完全分离的简易教务系统">实战—基于SpringBoot+shiro+Vue前后端完全分离的简易教务系统</a><time datetime="2021-10-18T13:30:46.000Z" title="发表于 2021-10-18 21:30:46">2021-10-18</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://tva1.sinaimg.cn/large/008i3skNly1gwyfm44hg3j30dm09uq2y.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2022 By 小新</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a href="icp链接"><img class="icp-icon" src="icp图片"><span>备案号：xxxxxx</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = false;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="true"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener toc scroll 
  window.removeEventListener('scroll', window.tocScrollFn)

  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    if (false) {
      location.hash && e.request.responseURL !== location.href ? pjax.loadUrl(location.href) : pjax.loadUrl('/404.html')
      return
    }
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>